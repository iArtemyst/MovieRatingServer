using MovieRating.Shared;
using System.Text.Json;
using System.Text.Json.Serialization;

namespace GatherMovieInfo
{
    internal class Program
    {
        const string RawIds = "tt1312221,tt31227572,tt10676052,tt12300742,tt26581740,tt30144839,tt29567915,tt29247040,tt31193180,tt5950044,tt1262426,tt30472557,tt14205554,tt1396484,tt36463894,tt26439764,tt17526714,tt0111161,tt11866324,tt0088763,tt1493274,tt4627382,tt16311594,tt32246771,tt37970307,tt0068646,tt33372494,tt32820897,tt0093773,tt0241527,tt9603208,tt0816692,tt0361748,tt20969586,tt14230458,tt26743210,tt1375666,tt1670345,tt31888477,tt0099785,tt6019206,tt27714581,tt0468569,tt0457430,tt5040012,tt0117913,tt0120737,tt0210945,tt34962891,tt0081505,tt6723592,tt15398776,tt31844586,tt5606664,tt14142060,tt0102926,tt24950660,tt0114369,tt28015403,tt29344903,tt27847051,tt29768334,tt0120689,tt0113277,tt0110912,tt32843349,tt0340855,tt12908150,tt0137523,tt0120616,tt38491451,tt0482571,tt6751668,tt5580390,tt0434409,tt0266697,tt7131622,tt0407887,tt0133093,tt1745960,tt28607951,tt0119217,tt14905854,tt1853728,tt2948356,tt0114814,tt2582802,tt32536315,tt0477348,tt11539996,tt0172495,tt15791034,tt17351924,tt36491653,tt0117571,tt18382850,tt0076759,tt1488589,tt0108052,tt0089218,tt7740496,tt0993846,tt7784604,tt31434639,tt1119646,tt0144084,tt0097165,tt4555426,tt0109830,tt0790724,tt36642456,tt1527793,tt0113189,tt2380307,tt18925334,tt15239678,tt0314331,tt1130884,tt2267998,tt1392214,tt0050083,tt0117381,tt0120338,tt8367814,tt0167404,tt0099685,tt5052448,tt0469494,tt26394837,tt0107290,tt8999762,tt11563598,tt30017619,tt1677720,tt0107688,tt0364569,tt2382320,tt1877830,tt0032138,tt1160419,tt8946378,tt7888964,tt0325980,tt1615147,tt0078748,tt2911666,tt0209144,tt1392170,tt0110413,tt0180093,tt5537002,tt0054215,tt0317248,tt0071562,tt0330373,tt0097958,tt0208092,tt1596363,tt14849194,tt0120382,tt1457767,tt0093779,tt1074638,tt0414387,tt5362988,tt0103064,tt0120815,tt0163651,tt1856101,tt0103874,tt0320661,tt0167260,tt6966692,tt4154796,tt0120663,tt2106476,tt0169547,tt0060196,tt0075314,tt8772262,tt6263850,tt0073486,tt12593682,tt2119532,tt0073629,tt0319343,tt0338013,tt4016934,tt4263482,tt0264464,tt0084787,tt1345836,tt0840361,tt18412256,tt0796366,tt1255953,tt0245429,tt0078788,tt0381061,tt1485796,tt0289043,tt0230600,tt0147800,tt1950186,tt37956153,tt0118799,tt0304141,tt36302733,tt3783958,tt32549601,tt3464902,tt0077651,tt0443706,tt0187393,tt0295297,tt0246578,tt7286456,tt1675434,tt0327056,tt29623480,tt0096874,tt0166924,tt0086250,tt6710474,tt0072890,tt0499549,tt0372784,tt0091251,tt0268978,tt0116629,tt3281548,tt0112573,tt3397884,tt0021884,tt0470752,tt0087363,tt0095016,tt0098554,tt0332280,tt1201607,tt2278388,tt2543164,tt0082971,tt0116282,tt0397535,tt0112641,tt0117666,tt9764362,tt0217505,tt17279496,tt8579674,tt32321317,tt1630029,tt5083738,tt0062622,tt0903624,tt14114802,tt0088247,tt0108358,tt0378194,tt0120586,tt10638522,tt0167261,tt9362722,tt0119643,tt5715874,tt0327597,tt1663202,tt0118749,tt2674426,tt1790885,tt0253474,tt3460252,tt6334354,tt11564570,tt0072431,tt4972582,tt1570728,tt0118715,tt0090605,tt0418279,tt31514146,tt0038650,tt27674982,tt2015381,tt3659388,tt0083658,tt1016150,tt10872600,tt27131358,tt1659337,tt0092099,tt0926084,tt0455944,tt2194499,tt0070047,tt23849204,tt0377092,tt0353969,tt1895587,tt4916630,tt0105236,tt1454029,tt0093058,tt0382932,tt0083866,tt1302006,tt0290673,tt5013056,tt1355644,tt31688586,tt0087332,tt11286314,tt0104257,tt0099487,tt0119116,tt11138512,tt2802144,tt0087843,tt3890160,tt0175880,tt0119654,tt4772188,tt27503384,tt1631867,tt0369339,tt9603212,tt0072271,tt13238346,tt5311514,tt0120201,tt0405094,tt0181875,tt27550504,tt0066921,tt5727208,tt1197624,tt0093748,tt1446714,tt0092005,tt1392190,tt0139654,tt1798709,tt0309987,tt0077416,tt0118655,tt0095327,tt0104952,tt0086879,tt12037194,tt6266538,tt0240772,tt0145487,tt0332452,tt0110357,tt0829482,tt0126029,tt0080684,tt0121164,tt0092890,tt0421715,tt20215234,tt1343092,tt6644200,tt15554778,tt10366206,tt1259521,tt10366460,tt0093437,tt21825416,tt16426418,tt1707386,tt2713180,tt0887912,tt10370710,tt0457939,tt0086066,tt0059742,tt0780504,tt0099674,tt1638355,tt9243946,tt35529436,tt31322753,tt0892769,tt2872718,tt4154756,tt14961016,tt0373889,tt1727824,tt14966898,tt1723811,tt0073195,tt0365748,tt0088847,tt6791350,tt8503618,tt5027774,tt0317219,tt0070735,tt7984734,tt0417741,tt0947798,tt2084970,tt0117951,tt1210166,tt0110475,tt0910970,tt7405458,tt3748528,tt0198781,tt0183790,tt1285016,tt0942385,tt0083929,tt0317705,tt0114709,tt0211915,tt0052918,tt1379182,tt0432283,tt30858568,tt0458352,tt1431045,tt0086465,tt2278871,tt0080339,tt22375054,tt0328107,tt0162661,tt0069947,tt0087800,tt17009710,tt0409459,tt27817389,tt9411972,tt9639470,tt8368368,tt4873118,tt0034583,tt19770238,tt0108399,tt0064116,tt2294629,tt0354668,tt0454848,tt0116695,tt0095705,tt4633694,tt0117008,tt1022603,tt21823606,tt4846340,tt0363163,tt0371746,tt0098635,tt13833688,tt0064115,tt2140479,tt2024544,tt4034228,tt0105323,tt1981677,tt0110148,tt5776858,tt0112471,tt0103772,tt26446278,tt0449059,tt0258463,tt9620292,tt2866360,tt3704428,tt0359950,tt0119488,tt0302886,tt0213847,tt10272386,tt0106677,tt1232829,tt1049413,tt0848228,tt0783233,tt10236164,tt11813216,tt1045658,tt0099088,tt2582782,tt0094721,tt0055031,tt5726616,tt32298285,tt0425112,tt0206634,tt0119177,tt0118971,tt0770828,tt0100157,tt0347149,tt27403986,tt0110322,tt6264654,tt2906216,tt2250912,tt2488496,tt1187043,tt0116483,tt34365591,tt0099653,tt0816711,tt2179136,tt0309698,tt1568346,tt0075148,tt0181689,tt3183660,tt34956443,tt0435625,tt1170358,tt0101272,tt0387564,tt0472043,tt29606526,tt10640346,tt1723121,tt1179933,tt0091042,tt7984766,tt8267604,tt0105695,tt0266543,tt0047478,tt0100405,tt1403865,tt0113540,tt0074119,tt0401792,tt0112384,tt0388795,tt1029234,tt2584384,tt26683420,tt27996020,tt1979320,tt0102685,tt0072684,tt3532216,tt4912910,tt0332379,tt0106977,tt0758758,tt21064584,tt0119174,tt0117060,tt1136608,tt1650062,tt4513678,tt0100814,tt0047396,tt0416449,tt0120735,tt0097576,tt1291584,tt0052357,tt0119698,tt0088930,tt5478478,tt2096673,tt37893389,tt1305806,tt2310332,tt1706620,tt11271038,tt0383574,tt3799694,tt0265086,tt0335266,tt0119167,tt0114746,tt0101540,tt0446029,tt0405422,tt0107048,tt0097815,tt0272338,tt23289160,tt0071315,tt0454921,tt0109686,tt1517451,tt1951264,tt0091763,tt0111257,tt0090329,tt1242460,tt38504137,tt0338751,tt0360486,tt0116367,tt2494362,tt0096163,tt0765010,tt0114388,tt0090756,tt0156887,tt29002950,tt0075686,tt3829920,tt1051906,tt0120611,tt0094012,tt3065204,tt0780536,tt29271622,tt0095953,tt7160372,tt0082340,tt0074285,tt0256009,tt0437086,tt15327088,tt1560747,tt3315342,tt0096256,tt0098319,tt0121766,tt0086190,tt1340800,tt9484998,tt0118694,tt0884328,tt0151804,tt0057012,tt6398184,tt3228774,tt0107614,tt2562232,tt16419074,tt14883538,tt0399146,tt0190590,tt0100802,tt0107943,tt1156398,tt1483013,tt0056058,tt0129387,tt0125439,tt0319061,tt4729430,tt1024648,tt0488120,tt1800241,tt3470600,tt0374900,tt5700672,tt2397535,tt0099077,tt0195685,tt0091369,tt0936501,tt4481414,tt0056172,tt6048922,tt0086960,tt4244994,tt1250777,tt0800369,tt0162222,tt0095765,tt0104691,tt3521164,tt0026138,tt4425200,tt11083552,tt0298130,tt1306980,tt0325710,tt8378126,tt0031381,tt5323662,tt0120903,tt0089881,tt0106489,tt1825683,tt1189340,tt5971474,tt2042568,tt0119282,tt0278504,tt7322224,tt0408236,tt0289879,tt0293508,tt0398286,tt0393162,tt3011894,tt12361974,tt0298148,tt0071853,tt4846232,tt2262227,tt1219289,tt0405159,tt0099810,tt0077631,tt0765429,tt0091203,tt0317740,tt0063522,tt0362227,tt0449088,tt1120985,tt2948372,tt2771200,tt0096895,tt1282140,tt0118884,tt1817273,tt0080455,tt2005151,tt2543472,tt0837562,tt0790636,tt22022452,tt33888205,tt4550098,tt0450259,tt0096283,tt1226837,tt0435761,tt0289765,tt0067992,tt0756683,tt4857264,tt11703710,tt4996328,tt0120812,tt9376612,tt0119396,tt0072288,tt0945513,tt4975722,tt0245844,tt1109624,tt38525492,tt0113497,tt4468740,tt0887883,tt3896198,tt1454468,tt0033467,tt2719848,tt0266987,tt3170832,tt0106856,tt1192628,tt0245574,tt5463162,tt0398808,tt0480249,tt0113247,tt6857376,tt0101414,tt1211837,tt0959337,tt0082933,tt0100935,tt2395427,tt0375679,tt0454876,tt0084516,tt1588170,tt5104604,tt0443453,tt0298203,tt0490215,tt0396269,tt0914798,tt5215952,tt0265343,tt7395114,tt1259528,tt0416320,tt0087538,tt1408101,tt3501632,tt6587046,tt0460791,tt0376541,tt1010048,tt0486655,tt0360717,tt26733325,tt0116922,tt0123948,tt6320628,tt0111282,tt0441773,tt0117500,tt0082096,tt0094737,tt0087469,tt8847712,tt5649144,tt0172493,tt1276104,tt0119099,tt6146586,tt1139797,tt0119008,tt4209788,tt0081398,tt10288566,tt0234215,tt1504320,tt0039190,tt1205489,tt3076658,tt0086567,tt22207786,tt2660888,tt0120863,tt2953050,tt2381249,tt6412452,tt7349662,tt26677014,tt4925292,tt0094947,tt0443680,tt6499752,tt0361862,tt1371111,tt0443272,tt23561236,tt0878804,tt1245526,tt0118929,tt0093409,tt6718170,tt3915174,tt0117665,tt0988045,tt1028528,tt0343818,tt0107818,tt0177789,tt0822854,tt3498820,tt0203009,tt21192142,tt0083907,tt0109506,tt1748122,tt1193138,tt1065073,tt4172430,tt0058331,tt0478970,tt36243564,tt0381681,tt1843866,tt0254686,tt0914863,tt0099871,tt0108550,tt0106226,tt0056592,tt0071115,tt0094625,tt12758060,tt21867434,tt0467406,tt0108037,tt8332922,tt1172049,tt0061722,tt0316654,tt1907668,tt0311113,tt0075860,tt0094226,tt0113409,tt8228288,tt0088323,tt3682448,tt0129167,tt14260836,tt1028532,tt0119822,tt0460740,tt0071230,tt0088680,tt1605783,tt7653254,tt0411477,tt0134119,tt1809398,tt0099348,tt8864596,tt8613070,tt1399683,tt0212720,tt3741834,tt0053125,tt1465522,tt1038988,tt10627720,tt0335345,tt37538305,tt0105265,tt4495098,tt1270798,tt9770150,tt0057115,tt0053604,tt0485947,tt0898367,tt0043014,tt0268380,tt0120762,tt1535109,tt0096446,tt0120655,tt3553976,tt0087803,tt2763304,tt0087884,tt5093026,tt1189073,tt0103639,tt0077745,tt0076734,tt0320691,tt3263904,tt2245084,tt2361509,tt0079944,tt0088258,tt0448134,tt11291274,tt1798684,tt0119094,tt0085334,tt0140352,tt0110632,tt0132477,tt0217869,tt0036775,tt0120363,tt0080678,tt28082769,tt1070874,tt0159097,tt1855199,tt1877832,tt1563738,tt0083944,tt1343727,tt4160708,tt1683526,tt2883512,tt0076729,tt0181865,tt5052474,tt0375063,tt0265666,tt23782584,tt6467266,tt0276919,tt0976051,tt1655441,tt0069762,tt1060277,tt0497465,tt1979376,tt27540542,tt0107207,tt0102138,tt0045152,tt0098384,tt0063442,tt0077975,tt36598036,tt29313285,tt0111503,tt2990140,tt0452623,tt1091191,tt0102266,tt29939499,tt1527186,tt13097932,tt0399295,tt15789038,tt4686844,tt0451279,tt0057565";
        const string OutPath = ".\\movie-list.json";

        public static async Task Main(string[] args)
        {
            string[] ids = RawIds.Split(',');

            HttpClient client = new HttpClient()
            {
                BaseAddress = new Uri("http://www.omdbapi.com"),
            };

            int currentIndex = 0;
            List<RawMovie> movieList = new List<RawMovie>();
            try
            {
                for (int i = 0; i < ids.Length; i++)
                {
                    currentIndex = i;
                    string id = ids[i];
                    var request = new HttpRequestMessage(HttpMethod.Get, new Uri($"?i={id}&apiKey={Constants.ApiKey}", UriKind.Relative));
                    var response = await client.SendAsync(request);
                    response.EnsureSuccessStatusCode();

                    var json = await response.Content.ReadAsStringAsync();
                    RawMovie movie = JsonSerializer.Deserialize<RawMovie>(json) ?? throw new Exception("Failed to deserialize to RawMovie");
                    movieList.Add(movie);

                    Console.WriteLine(movie.Title);

                    await Task.Delay(250);
                }
            }
            catch
            {
                Console.WriteLine($"Failed at index {currentIndex}");
                Console.WriteLine("Remaining ids:");
                Console.WriteLine(string.Join(",", ids.Skip(currentIndex)));
            }

            RawMovieList rawMovieList = new RawMovieList() { MovieDatabase = movieList };
            await File.WriteAllTextAsync(Path.GetFullPath(OutPath), JsonSerializer.Serialize(rawMovieList, new JsonSerializerOptions() { WriteIndented = true }));

            Console.WriteLine($"Done. Wrote {rawMovieList.MovieDatabase.Count} movies to {Path.GetFullPath(OutPath)}");
        }
    }
}
